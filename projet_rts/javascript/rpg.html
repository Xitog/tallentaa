<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Test</title>
    <style type="text/css">
      canvas { 
        border: 1px solid black;
      }
      html {
        width: 100%;
        height: 100%;
        background: rgb(10, 10, 10);
        overflow:hidden;
      }
      body {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      img.shadow {
        display: none;
      }
    </style>
  </head>
  <body onload="start();">
    <canvas id="screen" width="640" height="480">Your browser must support canvas to play.</canvas>
    <!-- Menu -->
    <img class="shadow" id="Move" src="graphics/gui/plain-arrow-by-Delapouite-CC-BY-3.0.png">
    <img class="shadow" id="Attack" src="graphics/gui/select-by-sbed-CC-BY-3.0.png">
    <img class="shadow" id="CreateSoldier" src="graphics/gui/robot-golem-by-Lorc-CC-BY-3.0.png">
    <img class="shadow" id="CreateScout" src="graphics/gui/battle-mech-by-Delapouite-CC-BY-3.0.png">
    <img class="shadow" id="CreateBuilder" src="graphics/gui/mono-wheel-robot-by-Delapouite-CC-BY-3.0.png">
    <!-- Buildings -->
    <img class="shadow" id="barrack" src="graphics/buildings/barrack.png">
    <img class="shadow" id="barrack_selected" src="graphics/buildings/barrack_selected.png">
    <img class="shadow" id="factory" src="graphics/buildings/factory.png">
    <img class="shadow" id="factory_selected" src="graphics/buildings/factory_selected.png">
    <img class="shadow" id="generator" src="graphics/buildings/generator.png">
    <img class="shadow" id="generator_selected" src="graphics/buildings/generator_selected.png">
    <!-- Water to Earth transitions W E | N E S W -->
      <!-- One Border -->
      <img class="shadow" id="0100010000" src="graphics/textures/0100010000.bmp">
      <img class="shadow" id="0100100000" src="graphics/textures/0100100000.bmp">
      <img class="shadow" id="0101000000" src="graphics/textures/0101000000.bmp">
      <img class="shadow" id="0110000000" src="graphics/textures/0110000000.bmp">
      <!-- Two Borders -->
      <img class="shadow" id="0111000000" src="graphics/textures/0111000000.bmp">
      <img class="shadow" id="0101100000" src="graphics/textures/0101100000.bmp">
      <img class="shadow" id="0100110000" src="graphics/textures/0100110000.bmp">
      <img class="shadow" id="0110010000" src="graphics/textures/0110010000.bmp">
      <!-- Corners -->
      <img class="shadow" id="0100001000" src="graphics/textures/0100001000.bmp">
      <img class="shadow" id="0100000100" src="graphics/textures/0100000100.bmp">
      <img class="shadow" id="0100000010" src="graphics/textures/0100000010.bmp">
      <img class="shadow" id="0100000001" src="graphics/textures/0100000001.bmp">
      <!-- 2 Corners -->
      <img class="shadow" id="0100001010" src="graphics/textures/0100001010.bmp">
      <img class="shadow" id="0100000101" src="graphics/textures/0100000101.bmp">
    <!-- Earth to Grass transitions W E | N E S W -->
      <!-- One Border -->
      <img class="shadow" id="1200010000" src="graphics/textures/1200010000.bmp">
      <img class="shadow" id="1200100000" src="graphics/textures/1200100000.bmp">
      <img class="shadow" id="1201000000" src="graphics/textures/1201000000.bmp">
      <img class="shadow" id="1210000000" src="graphics/textures/1210000000.bmp">
      <!-- Two Borders -->
      <img class="shadow" id="1211000000" src="graphics/textures/1211000000.bmp">
      <img class="shadow" id="1201100000" src="graphics/textures/1201100000.bmp">
      <img class="shadow" id="1200110000" src="graphics/textures/1200110000.bmp">
      <img class="shadow" id="1210010000" src="graphics/textures/1210010000.bmp">
      <!-- Corners -->
      <img class="shadow" id="1200001000" src="graphics/textures/1200001000.bmp">
      <img class="shadow" id="1200000100" src="graphics/textures/1200000100.bmp">
      <img class="shadow" id="1200000010" src="graphics/textures/1200000010.bmp">
      <img class="shadow" id="1200000001" src="graphics/textures/1200000001.bmp">
      <!-- 2 Corners -->
      <img class="shadow" id="1200001010" src="graphics/textures/1200001010.bmp">
      <img class="shadow" id="1200000101" src="graphics/textures/1200000101.bmp">
    <!-- Basic textures -->
    <img class="shadow" id="0000000000" src="graphics/textures/0000000000.bmp">
    <img class="shadow" id="1000000000" src="graphics/textures/1000000000.bmp">
    <img class="shadow" id="2000000000" src="graphics/textures/2000000000.bmp">
    <img class="shadow" id="3000000000" src="graphics/textures/3000000000.bmp">
    <script type="text/javascript">
    
      const SCREEN_WIDTH = 640;
      const SCREEN_HEIGHT = 480;
      
      const CAM_MAX_COL = 20; // = 640 / 32
      const CAM_MAX_ROW = 15; // = 480 / 32
      
      var textures = {};
      var screen = null;
      var mouse_col = -1;
      var mouse_row = -1;
      
      const KEY_UP = 38;
      const KEY_DOWN = 40;
      const KEY_RIGHT = 39;
      const KEY_LEFT = 37;
      const KEY_BACKSPACE = 8;
      const KEY_M = 77;
      
      function load() {
        for (let o of document.images) {
          textures[o.id] = o;
        }
      }
      
      function start() {
        screen = document.getElementById('screen');
        screen.onmousemove = on_mouse_move;
        window.onclick = on_mouse_left_click;
        window.oncontextmenu = on_mouse_right_click;
        window.onkeydown = on_key_down;
        window.onkeyup = on_key_up;
        window.setInterval(run, 33);
        load();
        run();
      }
      
      function run() {
        update();
        draw();
      }
      
      function update() {
      }
      
      function draw() {
        if (screen.getContext) {
          let ctx = screen.getContext('2d');
          for (let row = 0; row < CAM_MAX_ROW; row++) {
            for (let col = 0; col < CAM_MAX_COL; col++) {
              ctx.drawImage(textures['0100010000'], col * 32, row * 32);
            }
          }
          
          ctx.strokeStyle = 'rgb(0, 255, 0)';
          ctx.strokeRect(Math.floor(mouse_col / 32) * 32, Math.floor(mouse_row / 32) * 32, 32, 32);
            
          //ctx.fillStyle = 'rgb(255, 0, 0)';
          //ctx.fillRect(x, y, this.size, this.size);
          
          //ctx.strokeStyle = 'rgb(255, 242, 0)';
          //ctx.beginPath();
          //ctx.rect(this.x, this.y, this.size*32, this.size*32);
          //ctx.stroke();
          
          //ctx.beginPath();
          //ctx.arc(posx, posy, 10, 0, 2 * Math.PI);
          //ctx.fill();
        }
      }
      
      function on_mouse_move(event) {
        event = event || window.event;
        // Mouse coordinates
        let screenRect = screen.getBoundingClientRect();
        mouse_col = event.pageX - screenRect.left;
        mouse_row = event.pageY - screenRect.top;
        //mouse_map_col = Math.floor(mouse_col / 32) + camera.col;
        //mouse_map_row = Math.floor(mouse_row / 32) + camera.row;
      }
      
      function on_mouse_left_click(event) {
        event = event || window.event;
        console.log('Mouse col:', mouse_col, 'Mouse row:', mouse_row);
      }
      
      function on_mouse_right_click(event) {
        event = event || window.event;
        console.log('Mouse col:', mouse_col, 'Mouse row:', mouse_row);
        return false;     // prevent default menu
      }
      
      function on_key_up(event) {
        event = window.event || event;
        if (event.keyCode == KEY_UP) {
          //...
        } else {
          console.log('Unbound up key:', event.keyCode);
        }
      }
      
      function on_key_down(event){
        event = window.event || event;
        if (event.keyCode == KEY_LEFT) {
          //...
        } else {
          console.log('Unbound down key:', event.keyCode);
        }
      }
      
    </script>
  </body>
</html>