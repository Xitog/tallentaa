<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="user-scalable=no, width=device-width" />
        <title>Calcoolette</title>
        <link href='http://fonts.googleapis.com/css?family=Lobster' rel='stylesheet' type='text/css'>
        <link href='http://fonts.googleapis.com/css?family=Dosis' rel='stylesheet' type='text/css'>
        <style type="text/css">
        body {
            width:800px;
            margin: auto;
            margin-top: 10px;
            margin-bottom: 10px;
            color: #000000;
            background-color: #FFFFFF;
            border: 1px solid #e59e40;
            font-family: 'Dosis', monospace, "Consolas";
            //background-image:url(http://dribbble.s3.amazonaws.com/users/13774/screenshots/318774/attachments/13998/Midcenturian_1.jpg);
            //background-position:50% 50%;
            //background-repeat:no-repeat;
            //background-size: 100%;
        }
        td {
            border-right: 1px solid #000000;
        }
        tr {
            border-bottom: 1px solid #000000;
        }
        table {
            border-collapse: collapse;
        }
        td.number {
            color: #FFFFFF;
            background-color: #666666;
        }
        #box {
            width: 100%;
        }
        
        #input {
            width: 100%;
        }
        #input textarea {
            width: 790px;
            margin-top: 5px;
            margin-right: 5px;
            margin-left: 5px;
            box-sizing: border-box; 
            border: 1px solid #FF0000; 
            resize: none;
            overflow: hidden;
        }
        
        #output_lex table {
            width: 790px;
            margin-top: 5px;
            margin-right: 5px;
            margin-left: 5px;
            box-sizing: border-box;
        }
        
        #output_parse ul {
            width: 790px;
            margin-top: 5px;
            margin-right: 5px;
            margin-left: 5px;
            box-sizing: border-box;
        }
        
        #output_interpret #result {
            width: 790px;
            margin-top: 5px;
            margin-right: 5px;
            margin-left: 5px;
            padding-left: 2px;
            box-sizing: border-box;
            border: 1px solid #DDDDDD;
            //padding-bottom: 30px;   /* Height of the footer */
            display: none;
        }
        
        #menu {
            margin-top: 30px;
            width: 100%;
            text-align: center;
        }
        
        div.title {
            font-family: 'Dosis', sans-serif; // font-family: "Palatino Linotype";
            padding-left: 5px;
            text-decoration: underline;
            margin-top: 15px;
        }
        
        h1 {
            font-family: "Lobster", cursive, monospace, "Consolas", "Century Gothic";
            font-weight: 400;
            font-size: 24px;
            width: 100%;
            background-color: #e59e40;
            color: #4087e4;
            margin: auto;
            margin-top: 5px;
            text-align: center;
        }
        
        #footer {
            position: absolute;
            bottom: 0;
            width: 800px;
            height: 30px;   /* Height of the footer */
            font-family: "Lobster", cursive;
            font-weight: 100;
            font-size: 12px;
            color: #4087e4;
            text-align: center;
        }

        a {
            color: #4087e4;
        }
        
        button {
            background:none;
            border:none; 
            padding: 0;
            //border-bottom:1px solid #444; 
            color: #4087e4;
            text-decoration: underline;
            font-family: 'Dosis', sans-serif;
            font-size: 16px;
            cursor: pointer;
        }
        
        span.red {
            color: red;
        }
        
        //<div style="position: absolute; left: 10px; top: 10px; padding: 10px; width:50%; height: 50%; border: 1px solid #000000;">

        </style>
        <script src="calcoolette.js"></script>
        <script language="javascript" type="text/javascript" defer>
        <!--
            function myKeyPress(e) {
                var keynum;
                if (window.event) { // IE					
                    keynum = e.keyCode;
                } else {
                    if(e.which) { // Netscape/Firefox/Opera					
                        keynum = e.which;
                    }
                }
                if (keynum == 13) {
                    var o = document.getElementById("inputtext");
                    main(o.value);
                }
                //alert(keynum); //String.fromCharCode(keynum));
            }
            
            function execute() {
                var o = document.getElementById("inputtext");
                main(o.value);
                o.value = '';
                return false; // event.preventDefault(); 
            }
            
            function do_node(node) {
                if (node == null) {
                    return '';
                }
                s = "<li>" + node.value + " : " + node.kind;
                if (node.left !== null || node.right !== null) {
                    s += "<ul>";
                }
                if (node.left !== null) {
                    s += do_node(node.left);
                }
                if (node.right !== null) {
                    s += do_node(node.right);
                }
                if (node.left !== null || node.right !== null) {
                    s += "</ul>";
                }
                s += "</li>";
                return s;
            }
            function main(scmd) {
                // Clear everything
                // Reboot cmd
                var field_input = document.getElementById("inputtext");
                field_input.value = '';
                
                var title_lexing = document.getElementById("lex_title");
                title_lexing.innerHTML = '';
                var table = document.getElementById("myTable");
                while (table.rows.length > 0) {
                    table.deleteRow(0);
                }
                
                var title_parsing = document.getElementById("parse_title");
                title_parsing.innerHTML = "";
                var display_parsing = document.getElementById("parse_list");
                display_parsing.innerHTML = '';
                
                var title_interpret = document.getElementById("interpret_title");
                title_interpret.innerHTML = "";
                var display_result = document.getElementById("result");
                display_result.innerHTML = '';
                
                //var cmd = document.getElementsByName("cmd")[0];
                //var scmd = cmd.value;
                // Lexing
                // Lexing:Lex
                lex = new Lexer();
                try {
                    tokens = lex.tokenize(scmd); //r = lex.tokenize("a = 5; 12 + a * 2 + 20 # 42");
                    // Lexing:Display
                    title_lexing.innerHTML = "Lexing result";
                    for(i = tokens.length-1; i >= 0; i--) {
                        var row = table.insertRow(0);
                        if (i%2 == 0) {
                            row.bgColor = '#F6F6F6';
                        }
                        var cell0=row.insertCell(0);
                        var cell1=row.insertCell(1);
                        var cell2=row.insertCell(2);
                        cell0.innerHTML = "<span style='color: #FFFFFF'>"+i+"</span>";
                        cell0.bgColor = '#666666';
                        cell1.innerHTML = tokens[i].value;
                        cell2.innerHTML = tokens[i].kind;
                    }
                    var head = table.insertRow(0);
                    var head0 = head.insertCell(0);
                    var head1 = head.insertCell(1);
                    var head2 = head.insertCell(2);
                    head0.innerHTML = "<span style='color: #FFFFFF'>Number</span>";
                    head0.bgColor = '#666666';
                    head1.innerHTML = "Val";
                    head2.innerHTML = "Kind";
                } catch (err) {
                    title_lexing.innerHTML = "Lexing result ERROR";
                    var row = table.insertRow(0);
                    var cell0=row.insertCell(0);
                    cell0.innerHTML = scmd + "<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='red'>" + err.message + "</span>";
                    return;
                }
                // Parsing
                // Parsing:Parse
                parser = new Parser();
                try {
                    tree = parser.parse(tokens);
                    // Parsing:Display
                    title_parsing.innerHTML = "Parsing result";
                    display_parsing.innerHTML = do_node(tree);
                } catch (err) {
                    title_parsing.innerHTML = "Parsing result ERROR";
                    display_parsing.innerHTML = scmd + "<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='red'>" + err.message + "</span>";
                    return;
                }
                // Executing
                // Executing:Execute
                interp = new Interpreter();
                try {
                    result = interp.exec_node(tree);
                    // Executing:Display
                    title_interpret.innerHTML = "Interpretation result";
                    display_result.style.display = "block";
                    display_result.innerHTML = scmd + "<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>Result = </i>" + result.toStringTypedValue(); //toStringValue();
                } catch (err) {
                    title_interpret.innerHTML = "Interpretation result ERROR";
                    display_result.style.display = "block";
                    display_result.innerHTML = scmd + "<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='red'>" + err.message + "</span>";
                    return;
                }

            }
        // -->
        </script>
    </head>
    <body>
        <h1>Calcoolette</h1>
        <div id="box">
            <div id="output">
            </div>
            <div id="input">
                <textarea id="inputtext" rows="1" placeholder=">>> feed me some code here!" onkeypress="return myKeyPress(event)"></textarea>
            </div>
            <div id="output_lex">
                <div id="lex_title" class="title"></div>
                <table id="myTable" style="border:1px solid #000000;">
                </table>
            </div>
            <div id="output_parse">
                <div id="parse_title" class="title"></div>
                <ul id="parse_list">
                </ul>
            </div>
            <div id="output_interpret">
                <div id="interpret_title" class="title"></div>
                <div id="result"></div>
            </div>
            <div id="menu">
                 - <button onClick="execute()">Exécute</button> | <a href="http://ran.alwaysdata.net/">Retour</a> -
            </div>
            <div id="footer">Calcoolette 2012-2013</div>
        </div>
        <!--<input type="text" name="cmd"></input>-->
        <!--<button onclick="main()">Magic</button>-->
    </body>
</html>